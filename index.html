<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>BONANZA - John Pork's Underground</title>
    <style>
        :root {
            --gold: #d4af37;
            --red: #8b0000;
            --dark: #0a0a0a;
            --pork: #ffafcc;
        }

        body {
            background: var(--dark);
            color: white;
            font-family: 'Garamond', serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            height: 100vh;
        }

        /* BARRE DE STATS LUXE */
        .header {
            width: 100%;
            padding: 15px 40px;
            background: linear-gradient(to bottom, #222, #000);
            border-bottom: 2px solid var(--gold);
            display: flex;
            justify-content: space-between;
            box-sizing: border-box;
            font-family: sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #chips-val { color: var(--gold); font-weight: bold; font-size: 1.5rem; }

        /* MACHINE DE CASINO */
        .casino-container {
            margin-top: 50px;
            padding: 30px;
            background: var(--red);
            border: 10px solid var(--gold);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.3), inset 0 0 20px #000;
        }

        .reels-view {
            display: flex;
            gap: 15px;
            background: #000;
            padding: 15px;
            border: 5px solid #111;
            height: 120px;
            overflow: hidden;
        }

        .reel-track {
            width: 100px;
            display: flex;
            flex-direction: column;
            will-change: transform;
        }

        .symbol {
            width: 100px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            flex-shrink: 0;
        }

        /* Carr√©s de couleur DA Casino */
        .sym-B { background: radial-gradient(circle, #2b4cd6, #000); border: 2px solid #5a7fff; }
        .sym-N { background: radial-gradient(circle, #d62b2b, #000); border: 2px solid #ff5a5a; }
        .sym-Z { background: radial-gradient(circle, #2bd64c, #000); border: 2px solid #5aff7f; }

        /* BOUTON SPIN */
        .spin-btn {
            margin-top: 30px;
            padding: 20px 80px;
            background: var(--gold);
            color: #000;
            font-size: 1.8rem;
            font-weight: 900;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 5px 0 #8a6d0d;
            transition: 0.1s;
        }

        .spin-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #8a6d0d; }
        .spin-btn:disabled { background: #444; color: #888; box-shadow: none; cursor: not-allowed; }

        /* MODALE JOHN PORK (LA MENACE) */
        #pork-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000;
        }

        .countdown { font-size: 10rem; color: var(--gold); font-family: sans-serif; font-weight: 900; }

        .pork-content {
            display: none;
            text-align: center;
            animation: porkShake 0.1s infinite;
        }

        @keyframes porkShake {
            0% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -1px); }
        }

        .pork-img { width: 200px; height: 200px; background: var(--pork); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 80px; border: 5px solid white; margin: 0 auto 30px; }
        
        .pork-speech {
            font-family: sans-serif;
            font-size: 1.5rem;
            max-width: 600px;
            padding: 30px;
            background: #fff;
            color: #000;
            border-left: 10px solid var(--gold);
        }

        .btn-done { margin-top: 40px; padding: 15px 40px; background: var(--gold); border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div>Bonanza <span style="color:var(--gold)">Underground</span></div>
        <div>Chips: <span id="chips-val">100</span></div>
    </div>

    <div class="casino-container">
        <div class="reels-view">
            <div class="reel-track" id="r0"></div>
            <div class="reel-track" id="r1"></div>
            <div class="reel-track" id="r2"></div>
        </div>
    </div>

    <button id="spin-btn" class="spin-btn" onclick="play()">SPIN</button>

    <div id="pork-modal">
        <div id="pork-timer" class="countdown">3</div>
        <div id="pork-body" class="pork-content">
            <div class="pork-img">üê∑</div>
            <div class="pork-speech">
                <h2 id="gage-title" style="margin:0 0 15px 0">TITRE</h2>
                <p id="gage-desc">...</p>
                <p style="font-size: 0.9rem; color: red; margin-top: 20px;">‚Äî John Pork : "Fais √ßa vite sinon tu d√©gages !"</p>
            </div>
            <button class="btn-done" onclick="closePork()">OK JE L'AI FAIT</button>
        </div>
    </div>

<script>
    let chips = 100;
    const fruits = ['üç∫', 'üíÄ', 'üî•', 'üÉè', 'üçå', 'üçí', 'üçã'];
    const EVENTS = {
        DOUBLE: [
            { t: "CIBLE", d: "Donne 2 gorg√©es √† ton voisin de gauche." },
            { t: "LE SAVANT", d: "Cite 5 villes d'un pays en 10s ou bois 3 fois." },
            { t: "C'EST QUI ?", d: "Tout le monde pointe le plus 'lourd' √† 3. Le plus d√©sign√© boit." },
            { t: "FINGERS", d: "Dernier doigt sur le verre boit." },
            { t: "MARQUE", d: "Marque de voiture. Le premier qui s√®che boit." }
        ],
        TRIPLE: [
            { t: "DICTATEUR", d: "D√©signe 3 personnes qui doivent finir leur verre." },
            { t: "L'ENCH√àRE", d: "Le plus gros buveur sur ce tour √©vite le shot." },
            { t: "D√âCRET ROYAL", d: "Invente une r√®gle interdite." },
            { t: "CRACKLIST", d: "Th√®me : 'S√©ries Netflix'. Le premier qui s√®che boit." }
        ],
        BNZ: [{ t: "LE SAINT GRAAL", d: "Gagne 10 jetons IRL imm√©diatement." }]
    };

    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(f, d) {
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+d);
        o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+d);
    }

    // --- MOTEUR DE REELS INFINI ---
    function initReels() {
        [0,1,2].forEach(id => {
            const track = document.getElementById('r'+id);
            track.innerHTML = '';
            for(let i=0; i<10; i++) {
                const div = document.createElement('div');
                div.className = 'symbol';
                div.innerText = fruits[i%fruits.length];
                track.appendChild(div);
            }
        });
    }
    initReels();

    async function play() {
        if(chips < 10) return;
        chips -= 10;
        document.getElementById('chips-val').innerText = chips;
        document.getElementById('spin-btn').disabled = true;

        // Tirage
        const luck = Math.random();
        let res = [];
        if(luck < 0.03) res = ['B', 'N', 'Z'];
        else if(luck < 0.12) { const s = fruits[Math.floor(Math.random()*7)]; res = [s, s, s]; }
        else if(luck < 0.45) { const s = fruits[Math.floor(Math.random()*7)]; res = [s, s, fruits[0]]; }
        else { res = [fruits[0], fruits[1], fruits[2]]; }

        const anims = [0,1,2].map(id => spin(id, res[id]));
        await Promise.all(anims);
        
        setTimeout(() => check(res), 500);
    }

    function spin(id, target) {
        return new Promise(resolve => {
            const track = document.getElementById('r'+id);
            const count = 20 + (id * 10);
            const symbolHeight = 120;
            
            // On remplit la piste avec le r√©sultat √† la fin
            track.innerHTML = '';
            for(let i=0; i<count; i++) {
                const div = document.createElement('div');
                const s = (i === count - 1) ? target : fruits[Math.floor(Math.random()*7)];
                div.innerText = s;
                div.className = `symbol ${['B','N','Z'].includes(s) ? 'sym-'+s : ''}`;
                track.appendChild(div);
            }

            track.style.transition = 'none';
            track.style.transform = 'translateY(0)';
            track.offsetHeight; // Force reflow
            
            track.style.transition = `transform ${1.5 + id*0.5}s cubic-bezier(0.1, 0, 0, 1)`;
            track.style.transform = `translateY(-${(count-1)*symbolHeight}px)`;

            setTimeout(() => { beep(200+(id*100), 0.2); resolve(); }, 1500 + id*500);
        });
    }

    async function check(res) {
        let type = "";
        if (res[0]==='B' && res[1]==='N' && res[2]==='Z') type = "BNZ";
        else if (res[0] === res[1] && res[1] === res[2]) type = "TRIPLE";
        else if (res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) type = "DOUBLE";

        if(type !== "") {
            const ev = EVENTS[type][Math.floor(Math.random()*EVENTS[type].length)];
            if(type === "DOUBLE") chips += 5;
            if(type === "TRIPLE") chips += 50;
            
            // RESET GAGE POUR LE NOUVEAU
            document.getElementById('gage-title').innerText = "";
            document.getElementById('gage-desc').innerText = "";
            document.getElementById('pork-body').style.display = 'none';
            document.getElementById('pork-timer').style.display = 'block';
            document.getElementById('pork-modal').style.display = 'flex';

            for(let i=3; i>0; i--) {
                document.getElementById('pork-timer').innerText = i;
                beep(400, 0.1);
                await new Promise(r => setTimeout(r, 800));
            }
            
            document.getElementById('pork-timer').style.display = 'none';
            document.getElementById('gage-title').innerText = type + " : " + ev.t;
            document.getElementById('gage-desc').innerText = ev.d;
            document.getElementById('pork-body').style.display = 'block';
        } else {
            document.getElementById('spin-btn').disabled = false;
        }
        document.getElementById('chips-val').innerText = chips;
    }

    function closePork() {
        document.getElementById('pork-modal').style.display = 'none';
        document.getElementById('spin-btn').disabled = false;
    }
</script>
</body>
</html>
