<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>BONANZA - John Pork's Underground</title>
    <style>
        :root { --gold: #d4af37; --red: #8b0000; --dark: #0a0a0a; --pork: #ffafcc; }
        body { background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }

        /* √âCRAN DE S√âLECTION */
        #setup-screen { position: fixed; inset: 0; background: var(--dark); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 20px solid var(--red); }
        .mode-card { background: #111; border: 2px solid var(--gold); padding: 30px; margin: 10px; cursor: pointer; width: 300px; text-align: center; transition: 0.3s; }
        .mode-card:hover { background: var(--red); transform: scale(1.05); }

        /* UI JEU */
        .header { width: 100%; padding: 15px 40px; background: linear-gradient(to bottom, #222, #000); border-bottom: 2px solid var(--gold); display: flex; justify-content: space-between; box-sizing: border-box; }
        .casino-container { margin-top: 50px; padding: 30px; background: var(--red); border: 10px solid var(--gold); border-radius: 20px; box-shadow: 0 0 50px rgba(212,175,55,0.3); }
        .reels-view { display: flex; gap: 15px; background: #000; padding: 15px; height: 120px; overflow: hidden; border: 5px solid #111; }
        .reel-track { width: 100px; display: flex; flex-direction: column; }
        .symbol { width: 100px; height: 120px; display: flex; align-items: center; justify-content: center; font-size: 3.5rem; flex-shrink: 0; }
        
        .sym-B { background: radial-gradient(circle, #2b4cd6, #000); border: 2px solid #5a7fff; }
        .sym-N { background: radial-gradient(circle, #d62b2b, #000); border: 2px solid #ff5a5a; }
        .sym-Z { background: radial-gradient(circle, #2bd64c, #000); border: 2px solid #5aff7f; }

        .spin-btn { margin-top: 30px; padding: 20px 80px; background: var(--gold); color: #000; font-size: 1.8rem; font-weight: 900; border: none; cursor: pointer; border-radius: 5px; }
        .spin-btn:disabled { background: #444; }

        /* MODALE JOHN PORK */
        #pork-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .pork-speech { background: #fff; color: #000; padding: 30px; max-width: 500px; border-left: 10px solid var(--gold); text-align: center; }
        .countdown { font-size: 8rem; color: var(--gold); font-weight: 900; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h1 style="color:var(--gold); font-size: 3rem; margin-bottom: 40px;">CHOISIS TON DESTIN</h1>
        <div class="mode-card" onclick="initGame('SOLO')">
            <h2>MODE SOLO</h2>
            <p>D√©fis personnels uniquement.<br>Gains de jetons boost√©s (+15 par double).</p>
        </div>
        <div class="mode-card" onclick="initGame('EQUIPE')">
            <h2>MODE √âQUIPE</h2>
            <p>Jeux de groupe et duels.<br>Gains de jetons classiques (+5 par double).</p>
        </div>
    </div>

    <div class="header">
        <div>Bonanza <span id="mode-label" style="color:var(--gold)"></span></div>
        <div>Chips: <span id="chips-val">100</span></div>
    </div>

    <div class="casino-container">
        <div class="reels-view">
            <div class="reel-track" id="r0"></div>
            <div class="reel-track" id="r1"></div>
            <div class="reel-track" id="r2"></div>
        </div>
    </div>

    <button id="spin-btn" class="spin-btn" onclick="play()">SPIN</button>

    <div id="pork-modal">
        <div id="pork-timer" class="countdown">3</div>
        <div id="pork-body" style="display:none; text-align:center;">
            <div style="font-size:80px; margin-bottom:20px;">üê∑</div>
            <div class="pork-speech">
                <h2 id="gage-title"></h2>
                <p id="gage-desc"></p>
            </div>
            <button style="margin-top:30px; padding:15px 30px; cursor:pointer;" onclick="closePork()">C'EST FAIT</button>
        </div>
    </div>

<script>
    let chips = 100;
    let gameMode = "";
    const fruits = ['üç∫', 'üíÄ', 'üî•', 'üÉè', 'üçå', 'üçí', 'üçã'];

    const GAGES_SOLO = {
        DOUBLE: [
            { t: "CUL-SEC PARTIEL", d: "Bois la moiti√© de ton verre imm√©diatement." },
            { t: "LE SAVANT", d: "Cite 5 villes d'un pays en 10s. √âchec : 5 gorg√©es." },
            { t: "R√âSISTANCE", d: "Interdiction de boire la moindre goutte d'eau pendant 15 min. Faute : 4 gorg√©es." },
            { t: "LE MUET", d: "Tu n'as plus le droit de parler jusqu'√† ton prochain tour. Chaque mot co√ªte 1 gorg√©e." }
        ],
        TRIPLE: [
            { t: "EXTINCTEUR", d: "Finis ton verre cul-sec pour nettoyer la machine." },
            { t: "SHOT TIME", d: "John Pork t'offre un shot (de ton choix). Bois-le sans grimacer." }
        ]
    };

    const GAGES_EQUIPE = {
        DOUBLE: [
            { t: "CIBLE", d: "D√©signe une personne. Elle prend 4 gorg√©es." },
            { t: "SYLLABE", d: "Jeu des suites. Le premier qui bloque boit 4 gorg√©es." },
            { t: "FINGERS", d: "Dernier doigt sur la table boit 5 gorg√©es." },
            { t: "MARQUE", d: "Th√®me au choix. Le premier qui s√®che boit 4 gorg√©es." }
        ],
        TRIPLE: [
            { t: "DICTATEUR", d: "Choisis 2 personnes. Elles finissent leur verre." },
            { t: "D√âCRET", d: "R√®gle pour tous : interdiction de dire 'OUI' ou 'NON'. Faute = 2 gorg√©es." }
        ]
    };

    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(f, d) {
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+d);
        o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+d);
    }

    function initGame(mode) {
        gameMode = mode;
        document.getElementById('mode-label').innerText = mode;
        document.getElementById('setup-screen').style.display = 'none';
        [0,1,2].forEach(id => {
            const t = document.getElementById('r'+id);
            t.innerHTML = '<div class="symbol">üé∞</div>';
        });
    }

    async function play() {
        if(chips < 10) return;
        chips -= 10;
        document.getElementById('chips-val').innerText = chips;
        document.getElementById('spin-btn').disabled = true;

        const luck = Math.random();
        let res = [];
        if(luck < 0.03) res = ['B', 'N', 'Z'];
        else if(luck < 0.12) { const s = fruits[Math.floor(Math.random()*7)]; res = [s, s, s]; }
        else if(luck < 0.45) { const s = fruits[Math.floor(Math.random()*7)]; res = [s, s, fruits[0]]; }
        else { res = [fruits[0], fruits[1], fruits[2]].sort(()=>Math.random()-0.5); }

        const anims = [0,1,2].map(id => spin(id, res[id]));
        await Promise.all(anims);
        setTimeout(() => check(res), 500);
    }

    function spin(id, target) {
        return new Promise(resolve => {
            const track = document.getElementById('r'+id);
            const count = 20 + (id * 5);
            track.innerHTML = '';
            for(let i=0; i<count; i++) {
                const div = document.createElement('div');
                const s = (i === count - 1) ? target : fruits[Math.floor(Math.random()*7)];
                div.innerText = s;
                div.className = `symbol ${['B','N','Z'].includes(s) ? 'sym-'+s : ''}`;
                track.appendChild(div);
            }
            track.style.transition = 'none';
            track.style.transform = 'translateY(0)';
            track.offsetHeight;
            track.style.transition = `transform ${1.5 + id*0.5}s cubic-bezier(0.1, 0, 0, 1)`;
            track.style.transform = `translateY(-${(count-1)*120}px)`;
            setTimeout(() => { beep(200+(id*100), 0.2); resolve(); }, 1500 + id*500);
        });
    }

    async function check(res) {
        let type = "";
        if (res[0]==='B' && res[1]==='N' && res[2]==='Z') type = "BNZ";
        else if (res[0] === res[1] && res[1] === res[2]) type = "TRIPLE";
        else if (res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) type = "DOUBLE";

        if(type !== "") {
            // GAINS ADAPT√âS
            if(type === "DOUBLE") chips += (gameMode === "SOLO" ? 15 : 5);
            if(type === "TRIPLE") chips += (gameMode === "SOLO" ? 60 : 40);
            
            const pool = (gameMode === "SOLO" ? GAGES_SOLO : GAGES_EQUIPE)[type] || [{t:"JACKPOT", d:"Gagne 10 jetons IRL"}];
            const ev = pool[Math.floor(Math.random()*pool.length)];

            document.getElementById('pork-body').style.display = 'none';
            document.getElementById('pork-timer').style.display = 'block';
            document.getElementById('pork-modal').style.display = 'flex';

            for(let i=3; i>0; i--) {
                document.getElementById('pork-timer').innerText = i;
                beep(400, 0.1);
                await new Promise(r => setTimeout(r, 600));
            }
            
            document.getElementById('pork-timer').style.display = 'none';
            document.getElementById('gage-title').innerText = ev.t;
            document.getElementById('gage-desc').innerText = ev.d;
            document.getElementById('pork-body').style.display = 'block';
        } else {
            document.getElementById('spin-btn').disabled = false;
        }
        document.getElementById('chips-val').innerText = chips;
    }

    function closePork() {
        document.getElementById('pork-modal').style.display = 'none';
        document.getElementById('spin-btn').disabled = false;
    }
</script>
</body>
</html>
