<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BONANZA - John Pork Underground</title>
    <style>
        :root {
            --gold: #d4af37;
            --red: #8b0000;
            --dark: #0a0a0a;
            --pork-pink: #ffafcc;
            /* Pile de polices pour forcer le rendu Emoji iOS si possible, sinon propre */
            --emoji-font: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;
        }

        body {
            background: var(--dark);
            color: white;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* --- √âCRAN DE S√âLECTION --- */
        #setup-screen {
            position: fixed;
            inset: 0;
            background: var(--dark);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 15px solid var(--red);
            text-align: center;
        }

        .mode-container {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .mode-card {
            background: #111;
            border: 3px solid var(--gold);
            padding: 25px;
            width: 260px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 15px;
        }

        .mode-card:hover {
            background: var(--red);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(212, 175, 55, 0.4);
        }

        /* --- INTERFACE PRINCIPALE --- */
        .header {
            width: 100%;
            padding: 15px 40px;
            background: linear-gradient(to bottom, #222, #000);
            border-bottom: 3px solid var(--gold);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .casino-unit {
            margin-top: 60px;
            padding: 30px;
            background: var(--red);
            border: 12px solid var(--gold);
            border-radius: 25px;
            box-shadow: 0 0 60px rgba(212, 175, 55, 0.2), inset 0 0 30px #000;
            position: relative;
        }

        .reels-view {
            display: flex;
            gap: 15px;
            background: #000;
            padding: 20px;
            border: 6px solid #111;
            height: 140px;
            overflow: hidden;
            border-radius: 10px;
        }

        .reel-track {
            width: 110px;
            display: flex;
            flex-direction: column;
            will-change: transform;
        }

        .symbol {
            width: 110px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4.5rem;
            flex-shrink: 0;
            font-family: var(--emoji-font);
        }

        /* --- STYLES DES LETTRES BNZ --- */
        .sym-B, .sym-N, .sym-Z {
            font-family: 'Arial Black', sans-serif;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        .sym-B { background: radial-gradient(circle, #1e3a8a, #000); }
        .sym-N { background: radial-gradient(circle, #991b1b, #000); }
        .sym-Z { background: radial-gradient(circle, #065f46, #000); }

        .spin-btn {
            margin-top: 40px;
            padding: 25px 100px;
            background: linear-gradient(to bottom, #fde047, var(--gold));
            color: #000;
            font-size: 2rem;
            font-weight: 900;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 8px 0 #8a6d0d;
            transition: 0.1s;
            text-transform: uppercase;
        }

        .spin-btn:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #8a6d0d;
        }

        .spin-btn:disabled {
            background: #444;
            color: #777;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* --- MODALE JOHN PORK (WARIOWARE STYLE) --- */
        #pork-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .countdown {
            font-size: 12rem;
            color: var(--gold);
            font-weight: 900;
            text-shadow: 0 0 30px var(--gold);
        }

        #pork-body {
            text-align: center;
            max-width: 650px;
            width: 90%;
        }

        .pork-avatar {
            font-size: 100px;
            margin-bottom: 20px;
            font-family: var(--emoji-font);
            animation: shake 0.1s infinite;
        }

        .pork-speech {
            background: #fff;
            color: #000;
            padding: 35px;
            border-left: 15px solid var(--gold);
            border-radius: 0 30px 30px 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .gage-name {
            font-size: 2.2rem;
            margin: 0 0 15px 0;
            color: var(--red);
            text-transform: uppercase;
        }

        .gage-rule {
            font-size: 1.3rem;
            line-height: 1.5;
            color: #222;
        }

        .btn-done {
            margin-top: 40px;
            padding: 20px 50px;
            background: var(--gold);
            border: none;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 50px;
        }

        @keyframes shake {
            0% { transform: translate(2px, 2px); }
            50% { transform: translate(-2px, -2px); }
            100% { transform: translate(2px, -2px); }
        }
    </style>
</head>
<body>

    <!-- √âcran d'accueil -->
    <div id="setup-screen">
        <h1 style="color:var(--gold); font-size: 3rem; margin-bottom: 10px;">BONANZA UNDERGROUND</h1>
        <p style="font-size: 1.2rem; color: #aaa;">"Ici on encaisse des gorg√©es pour gagner des jetons."</p>
        <div class="mode-container">
            <div class="mode-card" onclick="initGame('SOLO')">
                <h2 style="color:var(--gold)">MODE SOLO</h2>
                <p>D√©fis personnels.<br><strong>BNZ = 15 Jetons IRL</strong></p>
            </div>
            <div class="mode-card" onclick="initGame('EQUIPE')">
                <h2 style="color:var(--gold)">MODE √âQUIPE</h2>
                <p>Duels et collectifs.<br><strong>BNZ = 25 Jetons IRL</strong></p>
            </div>
        </div>
    </div>

    <!-- Interface Casino -->
    <div class="header">
        <div class="logo">BONANZA <span style="color:var(--gold)">UNDERGROUND</span></div>
        <div id="mode-display" style="color:var(--gold); font-weight: bold; letter-spacing: 2px;"></div>
    </div>

    <div class="casino-unit">
        <div class="reels-view">
            <div class="reel-track" id="r0"><div class="symbol">üê∑</div></div>
            <div class="reel-track" id="r1"><div class="symbol">üêó</div></div>
            <div class="reel-track" id="r2"><div class="symbol">üç∫</div></div>
        </div>
    </div>

    <button id="spin-btn" class="spin-btn" onclick="play()">Lancer le destin</button>

    <!-- Modal John Pork -->
    <div id="pork-modal">
        <div id="pork-timer" class="countdown">3</div>
        <div id="pork-body" style="display:none;">
            <div class="pork-avatar">üê∑</div>
            <div class="pork-speech">
                <h2 id="gage-title" class="gage-name"></h2>
                <div id="gage-desc" class="gage-rule"></div>
                <p style="margin-top:25px; color:#666; font-style:italic; border-top:1px solid #eee; padding-top:15px;">
                    John Pork : "Vous avez int√©r√™t √† faire √ßa, sinon je vous d√©gage du casino les gros lards !"
                </p>
            </div>
            <button class="btn-done" onclick="closePork()">C'EST FAIT, JE REJOUE</button>
        </div>
    </div>

<script>
    let currentMode = "";
    const symbols = ['üê∑', 'üêó', 'üç∫', 'üíÄ'];
    
    const GAGES_SOLO = {
        DOUBLE: [
            { t: "LE SAVANT", d: "Le groupe choisit un pays. Cite 5 villes de ce pays en moins de 10 secondes. Si tu √©choues, bois 5 gorg√©es." },
            { t: "LA SYLLABE", d: "Dis un mot. Ton voisin de gauche doit en dire un commen√ßant par la derni√®re syllabe. Le premier qui bloque boit 4 gorg√©es." },
            { t: "CUL-SEC PARTIEL", d: "La machine r√©clame son d√ª. Bois la moiti√© de ton verre imm√©diatement." },
            { t: "R√âSISTANCE", d: "Il est interdit de poser ton verre sur la table pendant les 10 prochaines minutes. Chaque faute constat√©e = 2 gorg√©es." }
        ],
        TRIPLE: [
            { t: "LE SACRIFICE", d: "John Pork exige un tribut. Pr√©pare un shot m√©langeant deux alcools diff√©rents et bois-le cul-sec." },
            { t: "EXTINCTEUR", d: "Le casino surchauffe. Vide l'int√©gralit√© de ton verre actuel pour √©teindre l'incendie." }
        ],
        BNZ: [{ t: "BONANZA SOLO", d: "EXCEPTIONNEL ! Tu remportes 15 JETONS IRL pour l'ench√®re de minuit. Note-les bien sur ton compte !" }]
    };

    const GAGES_EQUIPE = {
        DOUBLE: [
            { t: "LA CIBLE", d: "D√©signe une personne du groupe. Elle doit boire imm√©diatement 4 grosses gorg√©es pour te permettre de continuer." },
            { t: "FINGERS", d: "Tout le monde pose un doigt sur le bord de la table. Le dernier √† s'ex√©cuter doit boire 5 gorg√©es." },
            { t: "MARQUE", d: "Choisis une cat√©gorie (ex: Marques de luxe). Tour √† tour, citez-en une. Le premier qui s√®che ou r√©p√®te boit 4 gorg√©es." },
            { t: "C'EST QUI ?", d: "√Ä 3, tout le monde pointe celui qui est le plus 'lourd' de la bande. Le plus d√©sign√© boit 5 gorg√©es." }
        ],
        TRIPLE: [
            { t: "LE DICTATEUR", d: "Tu as le plein pouvoir. Choisis deux personnes dans la pi√®ce : elles doivent finir leur verre cul-sec imm√©diatement." },
            { t: "D√âCRET ROYAL", d: "Invente une r√®gle interdite (ex: ne plus dire 'Mec'). Chaque personne qui enfreint la r√®gle boit 2 gorg√©es." }
        ],
        BNZ: [{ t: "BONANZA √âQUIPE", d: "JACKPOT TOTAL ! Ton √©quipe et toi gagnez 25 JETONS IRL pour l'ench√®re. Vous √™tes les rois du casino !" }]
    };

    // --- MOTEUR AUDIO ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(f, d, type = 'square') {
        const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
        o.type = type; o.frequency.value = f;
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + d);
    }

    function initGame(mode) {
        currentMode = mode;
        document.getElementById('mode-display').innerText = "MODE : " + mode;
        document.getElementById('setup-screen').style.display = 'none';
        beep(400, 0.2);
    }

    async function play() {
        document.getElementById('spin-btn').disabled = true;
        beep(200, 0.1);

        const luck = Math.random();
        let res = [];

        // Sc√©narios forc√©s pour un hasard √©quilibr√©
        if(luck < 0.035) { 
            // 3.5% Jackpot BNZ
            res = ['B', 'N', 'Z']; 
        } 
        else if(luck < 0.13) { 
            // 9.5% Triple
            const s = symbols[Math.floor(Math.random() * symbols.length)];
            res = [s, s, s];
        } 
        else if(luck < 0.48) { 
            // 35% Double
            const s = symbols[Math.floor(Math.random() * symbols.length)];
            let s2; do { s2 = symbols[Math.floor(Math.random() * symbols.length)]; } while(s2 === s);
            res = [s, s, s2].sort(() => Math.random() - 0.5);
        } 
        else { 
            // 52% Perte (3 diff√©rents, pas de jackpot)
            let s1, s2, s3;
            do {
                s1 = Math.random() > 0.85 ? 'B' : symbols[Math.floor(Math.random() * symbols.length)];
                s2 = Math.random() > 0.85 ? 'N' : symbols[Math.floor(Math.random() * symbols.length)];
                s3 = Math.random() > 0.85 ? 'Z' : symbols[Math.floor(Math.random() * symbols.length)];
            } while (s1 === s2 || s2 === s3 || s1 === s3 || (s1==='B' && s2==='N' && s3==='Z'));
            res = [s1, s2, s3];
        }

        const anims = [0,1,2].map(id => animateReel(id, res[id]));
        await Promise.all(anims);
        
        setTimeout(() => checkResult(res), 500);
    }

    function animateReel(id, target) {
        return new Promise(resolve => {
            const track = document.getElementById('r'+id);
            const count = 25 + (id * 7);
            const symHeight = 140;

            track.innerHTML = '';
            for(let i=0; i<count; i++) {
                const div = document.createElement('div');
                const s = (i === count - 1) ? target : symbols[Math.floor(Math.random() * symbols.length)];
                div.innerText = s;
                div.className = `symbol ${['B','N','Z'].includes(s) ? 'sym-'+s : ''}`;
                track.appendChild(div);
            }

            track.style.transition = 'none';
            track.style.transform = 'translateY(0)';
            track.offsetHeight; // Reflow

            track.style.transition = `transform ${1.8 + id*0.5}s cubic-bezier(0.1, 0, 0, 1)`;
            track.style.transform = `translateY(-${(count-1)*symHeight}px)`;

            setTimeout(() => {
                beep(200 + (id*100), 0.15, 'triangle');
                resolve();
            }, 1800 + id*500);
        });
    }

    async function checkResult(res) {
        let combo = "";
        if (res[0]==='B' && res[1]==='N' && res[2]==='Z') combo = "BNZ";
        else if (res[0] === res[1] && res[1] === res[2]) combo = "TRIPLE";
        else if (res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) combo = "DOUBLE";

        if(combo !== "") {
            const pool = (currentMode === "SOLO" ? GAGES_SOLO : GAGES_EQUIPE)[combo];
            const event = pool[Math.floor(Math.random() * pool.length)];

            // Reset modal state
            document.getElementById('gage-title').innerText = "";
            document.getElementById('gage-desc').innerText = "";
            document.getElementById('pork-body').style.display = 'none';
            document.getElementById('pork-timer').style.display = 'block';
            document.getElementById('pork-modal').style.display = 'flex';

            // Sequence WarioWare 3, 2, 1
            for(let i=3; i>0; i--) {
                document.getElementById('pork-timer').innerText = i;
                beep(400, 0.1, 'square');
                await new Promise(r => setTimeout(r, 700));
            }

            document.getElementById('pork-timer').style.display = 'none';
            document.getElementById('gage-title').innerText = combo + " : " + event.t;
            document.getElementById('gage-desc').innerText = event.d;
            document.getElementById('pork-body').style.display = 'block';
            beep(150, 0.4, 'sawtooth');
        } else {
            document.getElementById('spin-btn').disabled = false;
        }
    }

    function closePork() {
        document.getElementById('pork-modal').style.display = 'none';
        document.getElementById('spin-btn').disabled = false;
        beep(600, 0.1);
    }
</script>
</body>
</html>
