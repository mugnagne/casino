<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>BONANZA - John Pork's Underground</title>
    <style>
        :root {
            --gold: #d4af37;
            --red: #8b0000;
            --dark: #0a0a0a;
            --pork: #ffafcc;
        }

        body {
            background: var(--dark);
            color: white;
            font-family: 'Garamond', serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            height: 100vh;
        }

        /* BARRE DE STATS LUXE */
        .header {
            width: 100%;
            padding: 15px 40px;
            background: linear-gradient(to bottom, #222, #000);
            border-bottom: 2px solid var(--gold);
            display: flex;
            justify-content: space-between;
            box-sizing: border-box;
            font-family: sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #chips-val { color: var(--gold); font-weight: bold; font-size: 1.5rem; }

        /* MACHINE DE CASINO */
        .casino-container {
            margin-top: 50px;
            padding: 30px;
            background: var(--red);
            border: 10px solid var(--gold);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.3), inset 0 0 20px #000;
        }

        .reels-view {
            display: flex;
            gap: 15px;
            background: #000;
            padding: 15px;
            border: 5px solid #111;
            height: 120px;
            overflow: hidden;
        }

        .reel-track {
            width: 100px;
            display: flex;
            flex-direction: column;
            will-change: transform;
        }

        .symbol {
            width: 100px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            flex-shrink: 0;
        }

        /* Carr√©s de couleur DA Casino */
        .sym-B { background: radial-gradient(circle, #2b4cd6, #000); border: 2px solid #5a7fff; }
        .sym-N { background: radial-gradient(circle, #d62b2b, #000); border: 2px solid #ff5a5a; }
        .sym-Z { background: radial-gradient(circle, #2bd64c, #000); border: 2px solid #5aff7f; }

        /* BOUTON SPIN */
        .spin-btn {
            margin-top: 30px;
            padding: 20px 80px;
            background: var(--gold);
            color: #000;
            font-size: 1.8rem;
            font-weight: 900;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 5px 0 #8a6d0d;
            transition: 0.1s;
        }

        .spin-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #8a6d0d; }
        .spin-btn:disabled { background: #444; color: #888; box-shadow: none; cursor: not-allowed; }

        /* MODALE JOHN PORK (LA MENACE) */
        #pork-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000;
        }

        .countdown { font-size: 10rem; color: var(--gold); font-family: sans-serif; font-weight: 900; }

        .pork-content {
            display: none;
            text-align: center;
            animation: porkShake 0.1s infinite;
        }

        @keyframes porkShake {
            0% { transform: translate(1px, 1px); }
            50% { transform: translate(-1px, -1px); }
        }

        .pork-img { width: 200px; height: 200px; background: var(--pork); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 80px; border: 5px solid white; margin: 0 auto 30px; }
        
        .pork-speech {
            font-family: sans-serif;
            font-size: 1.5rem;
            max-width: 600px;
            padding: 30px;
            background: #fff;
            color: #000;
            border-left: 10px solid var(--gold);
        }

        .btn-done { margin-top: 40px; padding: 15px 40px; background: var(--gold); border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div>Bonanza <span style="color:var(--gold)">Underground</span></div>
        <div>Chips: <span id="chips-val">100</span></div>
    </div>

    <div class="casino-container">
        <div class="reels-view">
            <div class="reel-track" id="r0"></div>
            <div class="reel-track" id="r1"></div>
            <div class="reel-track" id="r2"></div>
        </div>
    </div>

    <button id="spin-btn" class="spin-btn" onclick="play()">SPIN</button>

    <div id="pork-modal">
        <div id="pork-timer" class="countdown">3</div>
        <div id="pork-body" class="pork-content">
            <div class="pork-img">üê∑</div>
            <div class="pork-speech">
                <h2 id="gage-title" style="margin:0 0 15px 0">TITRE</h2>
                <p id="gage-desc">...</p>
                <p style="font-size: 0.9rem; color: red; margin-top: 20px;">‚Äî John Pork : "Fais √ßa vite sinon tu d√©gages !"</p>
            </div>
            <button class="btn-done" onclick="closePork()">OK JE L'AI FAIT</button>
        </div>
    </div>

<script>
    let chips = 100;
    // Liste compl√®te des symboles pour le tirage al√©atoire
    const symbols = ['üç∫', 'üíÄ', 'üî•', 'üÉè', 'üçå', 'üçí', 'üçã'];
    
    const EVENTS = {
        DOUBLE: [
            { t: "LA CIBLE", d: "D√©signe une personne du groupe. Elle doit boire imm√©diatement 2 grosses gorg√©es de son verre." },
            { t: "LE MIROIR", d: "Choisis un partenaire. Jusqu'au prochain Double, chaque fois que tu bois une gorg√©e, il doit boire la m√™me chose, et inversement." },
            { t: "LA SYLLABE", d: "Dis un mot (ex: 'Bateau'). Ton voisin doit dire un mot commen√ßant par la derni√®re syllabe (ex: 'Tonneau'). Le premier qui h√©site ou r√©p√®te un mot boit 2 gorg√©es." },
            { t: "LE SAVANT", d: "Le groupe te donne un pays. Tu as 10 secondes pour citer 5 villes de ce pays. Si tu √©choues, tu bois 3 gorg√©es." },
            { t: "C'EST QUI ?", d: "Le joueur compte jusqu'√† 3. √Ä 3, tout le monde pointe du doigt la personne du groupe qu'il juge la plus 'lourde' ce soir. La personne la plus d√©sign√©e boit 3 gorg√©es." },
            { t: "FINGERS", d: "Tout le monde pose un doigt sur le bord de la table. Au signal, le dernier √† le faire doit boire 2 gorg√©es." },
            { t: "LA MARQUE", d: "Choisis une cat√©gorie (ex: Marques de bi√®re). Tour √† tour, citez-en une. Le premier qui s√®che ou se trompe boit 2 gorg√©es." },
            { t: "LE VETO", d: "Tu gagnes un 'Joker'. Tu peux l'utiliser plus tard pour annuler n'importe quelle gorg√©e que tu devrais prendre. (Usage unique)." }
        ],
        TRIPLE: [
            { t: "LE DICTATEUR", d: "Tu as le pouvoir absolu : choisis 3 personnes dans le groupe. Elles doivent toutes finir leur verre cul-sec imm√©diatement." },
            { t: "L'ENCH√àRE", d: "Annonce un nombre de gorg√©es (ex: 5). Quelqu'un peut surench√©rir (ex: 6) pour ne pas boire. Celui qui finit avec l'ench√®re la plus haute boit tout, les autres rien." },
            { t: "D√âCRET ROYAL", d: "Invente une r√®gle qui dure 10 minutes (ex: interdiction de dire le mot 'Mec' ou de toucher son t√©l√©phone). Quiconque l'enfreint boit 1 gorg√©e." },
            { t: "CRACKLIST", d: "Donne un th√®me (ex: 'S√©ries Netflix'). Chaque joueur doit en citer une en moins de 5 secondes. Le premier qui bloque prend un shot sec." },
            { t: "LE ROI", d: "Pendant les 3 prochains tours, personne n'a le droit de te regarder dans les yeux. Quiconque croise ton regard par erreur doit boire 1 gorg√©e." }
        ],
        BNZ: [{ t: "LE SAINT GRAAL", d: "C'est ton jour de chance. Tu remportes 10 jetons physiques (IRL). Ces jetons te donnent un pouvoir total sur la soir√©e. Garde-les pr√©cieusement." }]
    };

    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(f, d) {
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+d);
        o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+d);
    }

    function initReels() {
        [0,1,2].forEach(id => {
            const track = document.getElementById('r'+id);
            track.innerHTML = '';
            for(let i=0; i<10; i++) {
                const div = document.createElement('div');
                div.className = 'symbol';
                div.innerText = symbols[Math.floor(Math.random()*symbols.length)];
                track.appendChild(div);
            }
        });
    }
    initReels();

    async function play() {
        if(chips < 10) return;
        chips -= 10;
        document.getElementById('chips-val').innerText = chips;
        document.getElementById('spin-btn').disabled = true;

        const luck = Math.random();
        let res = ["", "", ""];

        // LOGIQUE DE TIRAGE VRAIMENT AL√âATOIRE
        if(luck < 0.02) { 
            // 2% de chance Jackpot
            res = ['B', 'N', 'Z']; 
        } 
        else if(luck < 0.10) { 
            // 8% de chance Triple
            const s = symbols[Math.floor(Math.random()*symbols.length)];
            res = [s, s, s];
        } 
        else if(luck < 0.40) { 
            // 30% de chance Double
            const s = symbols[Math.floor(Math.random()*symbols.length)];
            let other;
            do { other = symbols[Math.floor(Math.random()*symbols.length)]; } while(other === s);
            res = [s, s, other].sort(() => Math.random() - 0.5);
        } 
        else { 
            // 60% Perte (On s'assure qu'aucun symbole n'est identique)
            let s1, s2, s3;
            do {
                s1 = Math.random() > 0.9 ? 'B' : symbols[Math.floor(Math.random()*symbols.length)];
                s2 = Math.random() > 0.9 ? 'N' : symbols[Math.floor(Math.random()*symbols.length)];
                s3 = Math.random() > 0.9 ? 'Z' : symbols[Math.floor(Math.random()*symbols.length)];
            } while (s1 === s2 || s2 === s3 || s1 === s3 || (s1==='B' && s2==='N' && s3==='Z'));
            res = [s1, s2, s3];
        }

        const anims = [0,1,2].map(id => spin(id, res[id]));
        await Promise.all(anims);
        setTimeout(() => check(res), 500);
    }

    function spin(id, target) {
        return new Promise(resolve => {
            const track = document.getElementById('r'+id);
            const count = 25 + (id * 8);
            const symbolHeight = 120;
            
            track.innerHTML = '';
            for(let i=0; i<count; i++) {
                const div = document.createElement('div');
                // On met le r√©sultat √† la fin, et de l'al√©atoire avant
                const s = (i === count - 1) ? target : symbols[Math.floor(Math.random()*symbols.length)];
                div.innerText = s;
                div.className = `symbol ${['B','N','Z'].includes(s) ? 'sym-'+s : ''}`;
                track.appendChild(div);
            }

            track.style.transition = 'none';
            track.style.transform = 'translateY(0)';
            track.offsetHeight; 
            
            track.style.transition = `transform ${1.8 + id*0.6}s cubic-bezier(0.1, 0, 0, 1)`;
            track.style.transform = `translateY(-${(count-1)*symbolHeight}px)`;

            setTimeout(() => { beep(150+(id*100), 0.15); resolve(); }, 1800 + id*600);
        });
    }

    async function check(res) {
        let type = "";
        if (res[0]==='B' && res[1]==='N' && res[2]==='Z') type = "BNZ";
        else if (res[0] === res[1] && res[1] === res[2]) type = "TRIPLE";
        else if (res[0] === res[1] || res[1] === res[2] || res[0] === res[2]) type = "DOUBLE";

        if(type !== "") {
            const pool = EVENTS[type];
            const ev = pool[Math.floor(Math.random()*pool.length)];
            if(type === "DOUBLE") chips += 5;
            if(type === "TRIPLE") chips += 50;
            
            document.getElementById('gage-title').innerText = "";
            document.getElementById('gage-desc').innerText = "";
            document.getElementById('pork-body').style.display = 'none';
            document.getElementById('pork-timer').style.display = 'block';
            document.getElementById('pork-modal').style.display = 'flex';

            for(let i=3; i>0; i--) {
                document.getElementById('pork-timer').innerText = i;
                beep(300, 0.1);
                await new Promise(r => setTimeout(r, 800));
            }
            
            document.getElementById('pork-timer').style.display = 'none';
            document.getElementById('gage-title').innerText = type + " : " + ev.t;
            document.getElementById('gage-desc').innerText = ev.d;
            document.getElementById('pork-body').style.display = 'block';
            beep(100, 0.4);
        } else {
            document.getElementById('spin-btn').disabled = false;
        }
        document.getElementById('chips-val').innerText = chips;
    }

    function closePork() {
        document.getElementById('pork-modal').style.display = 'none';
        document.getElementById('spin-btn').disabled = false;
    }
</script>
</body>
</html>
